import { Actions, createEffect, ofType } from "@ngrx/effects";
import { DataService } from "src/app/Service/data.service";
import { addMovie, addMoviesSuccess, getMovies, getMoviesSuccess } from "../Actions/movie.action";
import { concatMap, exhaustMap, map, tap } from "rxjs/operators";
import { Injectable } from "@angular/core";

@Injectable()
export class MovieEffects {

    constructor(private action$: Actions, private ds: DataService) { }

    loadMovie$ = createEffect(() =>
        this.action$.pipe(
            ofType(getMovies),
            exhaustMap(() =>
                this.ds.getMovies().pipe(
                    map((movies) => getMoviesSuccess(movies))
                )
            )
        )

    )
    addMovie$ = createEffect(() =>
        this.action$.pipe(
            ofType(addMovie),
            tap((movie) => console.log(movie)),
            concatMap(({ movie }) =>
                this.ds.addMovies(movie).pipe(
                    map((newMovie) => addMoviesSuccess(newMovie))
                )
            )
        )


    )
}
